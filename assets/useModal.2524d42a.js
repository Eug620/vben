import{d as e,s as t,y as o,bN as n,z as a,an as l,r as s,c as r,aI as i,q as c,ay as u,u as d,a$ as p,bO as f,ad as g,B as m,C as h,aZ as y,b,A as v,b0 as w}from"./index.12c9c6d9.js";import{s as B}from"./BasicTitle.a1ecdb29.js";import{a as H,r as C,s as S}from"./LazyContainer.8b895cd0.js";import{C as x}from"./CloseOutlined.37d2ceb1.js";import{a as O,F as k}from"./FullscreenOutlined.5c776816.js";import{e as F,g as M}from"./tsxHelper.629ff8d8.js";import{u as P}from"./useWindowSize.8d67cb61.js";import{b as j}from"./uuid.51fc09fb.js";const E={visible:Boolean,draggable:{type:Boolean,default:!0},centered:{type:Boolean,default:!1},cancelText:{type:String,default:"关闭"},okText:{type:String,default:"保存"},closeFunc:Function},N=Object.assign({},E,{canFullscreen:{type:Boolean,default:!0},wrapperFooterOffset:{type:Number,default:0},helpMessage:[String,Array],useWrapper:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},showCancelBtn:{type:Boolean,default:!0},showOkBtn:{type:Boolean,default:!0},wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:Boolean,destroyOnClose:Boolean,footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},visible:Boolean,width:[String,Number],wrapClassName:{type:String},zIndex:{type:Number}});var T=e({name:"Modal",inheritAttrs:!1,props:N,setup(e,{attrs:l,slots:s}){const r=(e,t)=>getComputedStyle(e)[t],i=t=>{if(!t)return;t.setAttribute("data-drag",e.draggable);const o=t.querySelector(".ant-modal-header"),n=t.querySelector(".ant-modal");o&&n&&e.draggable&&(o.style.cursor="move",o.onmousedown=e=>{const t=e.clientX,o=e.clientY,a=document.body.clientWidth,l=document.documentElement.clientHeight,s=n.offsetWidth,i=n.offsetHeight,c=n.offsetLeft,u=a-n.offsetLeft-s,d=n.offsetTop,p=l-n.offsetTop-i,f=r(n,"left"),g=r(n,"top");let m=+f,h=+g;f.includes("%")?(m=+document.body.clientWidth*(+f.replace(/%/g,"")/100),h=+document.body.clientHeight*(+g.replace(/%/g,"")/100)):(m=+f.replace(/px/g,""),h=+g.replace(/px/g,"")),document.onmousemove=function(e){let a=e.clientX-t,l=e.clientY-o;-a>c?a=-c:a>u&&(a=u),-l>d?l=-d:l>p&&(l=p),n.style.cssText+=`;left:${a+m}px;top:${l+h}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})};return t((()=>{e.visible&&a((()=>{(()=>{const t=document.querySelectorAll(".ant-modal-wrap");for(const o of t){const t=r(o,"display"),n=o.getAttribute("data-drag");"none"!==t&&(null===n||e.destroyOnClose)&&i(o)}})()}),30)})),()=>{const t={...l,...e};return o(n,{...t},F(s))}}});var q=e({name:"ModalWrapper",emits:["heightChange","getExtHeight"],props:{loading:{type:Boolean,default:!1},modalHeaderHeight:{type:Number,default:50},modalFooterHeight:{type:Number,default:70},minHeight:{type:Number,default:200},footerOffset:{type:Number,default:0},visible:{type:Boolean,default:!1},fullScreen:{type:Boolean,default:!1}},setup(e,{slots:n,emit:g}){const m=s(null),h=s(null),y=s(0),b=r((()=>({minHeight:e.minHeight+"px",overflow:"hidden"})));let v=0;async function w(){if(!e.visible)return;const t=d(m);if(!t)return;const o=t.parentElement;if(o){o.style.padding="0",await i();try{const t=o.parentElement&&o.parentElement.parentElement;if(!t)return;const n=getComputedStyle(t).top,l=Number.parseInt(n);let s=window.innerHeight-2*l+(e.footerOffset||0)-e.modalFooterHeight-e.modalHeaderHeight;l<40&&(s-=26),await i();const r=d(h);if(!r)return void a((()=>{v<3&&w(),v++}),10);v=0;const c=r.$el.querySelector(".ant-spin-container").scrollHeight;e.fullScreen?y.value=window.innerHeight-e.modalFooterHeight-e.modalHeaderHeight-26:y.value=c>s?s:c+16+30,g("heightChange",d(y)),i((()=>{const e=r.$el;e&&(e.style.height=d(y)+"px")}))}catch(e){console.log(e)}}}function B(){const e=d(m);if(!e)return;const t=e.querySelector(".ant-spin-container");if(!t)return;const[o,n]=function(e,t,o=100,n){let a=()=>{t()};const[s,r]=l(a,o,n);return a=o?s:a,[function(){H(e,a)},function(){C(e,a),r()}]}(t,(()=>{w()}));o(),p((()=>{n()}))}return i((()=>{})),t((()=>{w()})),c((()=>e.fullScreen),(e=>{!e&&w()})),u((()=>{const{modalHeaderHeight:t,modalFooterHeight:o}=e;g("getExtHeight",t+o),B()})),P(w),()=>{const t=d(y);return o("div",{ref:m,style:d(b)},o(S,null,(()=>o(f,{ref:h,spinning:e.loading,style:{height:t+"px"}},(()=>M(n))))))}}}),L=e({name:"BasicModal",props:N,emits:["visible-change","height-change","cancel","ok","register"],setup(e,{slots:n,emit:a,attrs:l}){const i=s(!1),u=s(null),p=s(null),f=s(0),b=s(0),v=s(!1),w=r((()=>({...e,...d(u)}))),H=r((()=>{const t={...e,...d(u)||{},visible:d(i),title:void 0},{wrapClassName:o=""}=t,n=d(v)?o+" fullscreen-modal":o;return{...t,wrapClassName:n}}));async function C(t){if(t.stopPropagation(),e.closeFunc&&h(e.closeFunc)){const t=await e.closeFunc();i.value=!t}else i.value=!1,a("cancel")}function S(e){e.stopPropagation(),v.value=!d(v);const t=d(p);if(t){const e=t.$el.querySelector(".ant-spin-nested-loading");e&&(!d(b)&&d(v)&&(b.value=e.offsetHeight,console.log(b)),d(v)?e.style.height=window.innerHeight-d(f)+"px":e.style.height=d(b)+"px")}}t((()=>{i.value=!!e.visible})),c((()=>d(i)),(e=>{a("visible-change",e)}),{immediate:!1});const P={setModalProps:function(e){u.value=y(d(u)||{},e),Reflect.has(e,"visible")&&(i.value=!!e.visible)}},E=j();return a("register",P,E),()=>o(T,{onCancel:C,...{...l,...e,...d(H)},getContainer:()=>document.querySelector(".default-layout__main")},{...F(n,["default"]),default:()=>function(){const{useWrapper:t,loading:l,wrapperProps:s}=d(H);return t?o(q,{footerOffset:e.wrapperFooterOffset,fullScreen:d(v),ref:p,loading:l,visible:d(i),...s,onGetExtHeight:e=>{f.value=e},onHeightChange:e=>{a("height-change",e)}},(()=>M(n))):M(n)}(),closeIcon:()=>function(){const{canFullscreen:e}=d(H);return e?o("div",{class:"custom-close-icon"},d(v)?o(O,{role:"full",onClick:S}):o(k,{role:"close",onClick:S}),o(x,{onClick:C})):null}(),footer:()=>function(){const{showCancelBtn:e,cancelButtonProps:t,cancelText:l,showOkBtn:s,okType:r,okText:i,okButtonProps:c,confirmLoading:u}=d(H);return o(g,null,M(n,"insertFooter"),e&&o(m,{...t,onClick:C},(()=>l)),M(n,"centerdFooter"),s&&o(m,{type:r,loading:u,onClick:()=>{a("ok")},...c},(()=>i)),M(n,"appendFooter"))}(),title:()=>function(){const{helpMessage:e}=d(H),{title:t}=d(w);return o(B,{helpMessage:e},(()=>n.title?M(n,"title"):t))}()})}});const W=b({});function A(){if(!v())throw new Error("Please put useModal function in the setup function!");const e=s(null),t=s(!1),o=s("");const n=()=>{const t=d(e);if(!t)throw new Error("instance is undefined!");return t};return[function(n,a){o.value=a,p((()=>{e.value=null,t.value=!1,W[d(o)]=null})),d(t)&&w()&&n===d(e)||(e.value=n)},{setModalProps:e=>{n().setModalProps(e)},openModal:(e=!0)=>{n().setModalProps({visible:e})},transferModalData(e){W[d(o)]=e}}]}const $=()=>{const e=s(null),t=v(),o=s("");if(!t)throw new Error("instance is undefined!");const n=()=>{const t=d(e);if(!t)throw new Error("instance is undefined!");return t};return[(n,a)=>{o.value=a,e.value=n,t.emit("register",n)},{receiveModalDataRef:r((()=>W[d(o)])),changeLoading:(e=!0)=>{n().setModalProps({loading:e})},changeOkLoading:(e=!0)=>{n().setModalProps({confirmLoading:e})},closeModal:()=>{n().setModalProps({visible:!1})},setModalProps:e=>{n().setModalProps(e)}}]};export{L as B,A as a,$ as u};
