import{d as t,b as e,r as s,q as i,s as n,c as a,v as o,x as r,y as c,u as l,z as d,A as u}from"./index.12c9c6d9.js";import{h as m}from"./domUtils.0cbdb707.js";import{C as g}from"./CheckOutlined.50516744.js";import{D as p}from"./DoubleRightOutlined.3cd7ab31.js";import{g as f}from"./tsxHelper.629ff8d8.js";const h={value:{type:Boolean,default:!1},isSlot:{type:Boolean,default:!1},text:{type:[String],default:"请按住滑块拖动"},successText:{type:[String],default:"验证通过"},height:{type:[Number,String],default:40},width:{type:[Number,String],default:220},circle:{type:Boolean,default:!1},wrapStyle:{type:Object,default:{}},contentStyle:{type:Object,default:{}},barStyle:{type:Object,default:{}},actionStyle:{type:Object,default:{}}},y={...h,src:{type:String},imgWidth:{type:Number,default:260},imgWrapStyle:{type:Object,default:{}},minDegree:{type:Number,default:90},maxDegree:{type:Number,default:270},diffDegree:{type:Number,default:20}};var v=t({name:"BaseDargVerify",props:h,emits:["success","update:value","change","start","move","end"],setup(t,{emit:u,slots:m}){const h=e({isMoving:!1,isPassing:!1,moveDistance:0,toLeft:!1,startTime:0,endTime:0}),y=s(null),v=s(null),w=s(null),x=s(null);i((()=>h.isPassing),(t=>{if(t){const{startTime:e,endTime:s}=h;u("success",{isPassing:t,time:((s-e)/1e3).toFixed(1)}),u("update:value",t),u("change",t)}})),n((()=>{h.isPassing=!!t.value}));const T=a((()=>{const{height:e,actionStyle:s}=t,i=parseInt(e)+"px";return{left:0,width:i,height:i,...s}})),S=a((()=>{const{height:e,width:s,circle:i,wrapStyle:n}=t,a=parseInt(e);return{width:parseInt(s)+"px",height:a+"px",lineHeight:a+"px",borderRadius:i?a/2+"px":0,...n}})),b=a((()=>{const{height:e,circle:s,barStyle:i}=t,n=parseInt(e);return{height:n+"px",borderRadius:s?n/2+"px 0 0 "+n/2+"px":0,...i}})),D=a((()=>{const{height:e,width:s,contentStyle:i}=t;return{height:parseInt(e)+"px",width:parseInt(s)+"px",...i}}));function M(t){return t.pageX||t.touches[0].pageX}function P(t){if(h.isPassing)return;const e=l(x);e&&(u("start",t),h.moveDistance=M(t)-parseInt(e.style.left.replace("px",""),10),h.startTime=(new Date).getTime(),h.isMoving=!0)}function I(e){const s=parseInt(e.style.width),{width:i}=t,n=parseInt(i);return{offset:n-s-6,widthNum:n,actionWidth:s}}function R(e){const{isMoving:s,moveDistance:i}=h;if(s){const s=l(x),n=l(v);if(!s||!n)return;const{offset:a,widthNum:o,actionWidth:r}=I(s),c=M(e)-i;u("move",{event:e,moveDistance:i,moveX:c}),c>0&&c<=a?(s.style.left=c+"px",n.style.width=c+r/2+"px"):c>a&&(s.style.left=o-r+"px",n.style.width=o-r/2+"px",t.isSlot||j())}}function O(e){const{isMoving:s,isPassing:i,moveDistance:n}=h;if(s&&!i){u("end",e);const s=l(x),i=l(v);if(!s||!i)return;const a=M(e)-n,{offset:o,widthNum:r,actionWidth:c}=I(s);a<o?t.isSlot?setTimeout((()=>{if(t.value){const t=l(w);t&&(t.style.width=parseInt(i.style.width)+"px")}else _()}),0):_():(s.style.left=r-c+"px",i.style.width=r-c/2+"px",j()),h.isMoving=!1}}function j(){t.isSlot?_():(h.endTime=(new Date).getTime(),h.isPassing=!0,h.isMoving=!1)}function _(){h.isMoving=!1,h.isPassing=!1,h.moveDistance=0,h.toLeft=!1,h.startTime=0,h.endTime=0;const t=l(x),e=l(v),s=l(w);t&&e&&s&&(h.toLeft=!0,d((()=>{h.toLeft=!1,t.style.left="0",e.style.width="0"}),300),s.style.width=l(D).width)}return o({el:document,name:"mouseup",listener:()=>{h.isMoving&&_()}}),r((t=>{t.resume=_})),()=>c("div",{class:"darg-verify",ref:y,style:l(S),onMousemove:R,onTouchmove:R,onMouseleave:O,onMouseup:O,onTouchend:O},(()=>{const t=["darg-verify-bar"];return h.toLeft&&t.push("to-left"),c("div",{class:t,ref:v,style:l(b)})})(),(()=>{const e=["darg-verify-content"],{isPassing:s}=h,{text:i,successText:n}=t;return s&&e.push("success"),c("div",{class:e,ref:w,style:l(D)},f(m,"text",s)||(s?n:i))})(),(()=>{const t=["darg-verify-action"],{toLeft:e,isPassing:s}=h;return e&&t.push("to-left"),c("div",{class:t,onMousedown:P,onTouchstart:P,style:l(T),ref:x},f(m,"actionIcon",s)||c(s?g:p,{class:"darg-verify-action__icon"}))})())}}),w=t({name:"ImgRotateDargVerify",inheritAttrs:!1,props:y,emits:["success","change","update:value"],setup(t,{emit:n,attrs:o}){const r=s(null),g=e({showTip:!1,isPassing:!1,imgStyle:{},randomRotate:0,currentRotate:0,toOrigin:!1,startTime:0,endTime:0,draged:!1});i((()=>g.isPassing),(t=>{if(t){const{startTime:e,endTime:s}=g;n("success",{isPassing:t,time:((s-e)/1e3).toFixed(1)}),n("change",t),n("update:value",t)}}));const p=a((()=>{const{imgWrapStyle:e,imgWidth:s}=t;return{width:s+"px",height:s+"px",...e}})),f=a((()=>{const{minDegree:e,maxDegree:s}=t;return e===s?Math.floor(1+1*Math.random())/10+1:1}));function h(){g.startTime=(new Date).getTime()}function y(e){g.draged=!0;const{imgWidth:s,height:i,maxDegree:n}=t,{moveX:a}=e,o=Math.ceil(a/(s-parseInt(i))*n*l(f));g.currentRotate=o,g.imgStyle=m("transform",`rotateZ(${g.randomRotate-o}deg)`)}function w(){const{minDegree:e,maxDegree:s}=t,i=Math.floor(e+Math.random()*(s-e));g.randomRotate=i,g.imgStyle=m("transform",`rotateZ(${i}deg)`)}function x(){const{randomRotate:e,currentRotate:s}=g,{diffDegree:i}=t;Math.abs(e-s)>=(i||20)?(g.imgStyle=m("transform",`rotateZ(${e}deg)`),g.toOrigin=!0,d((()=>{g.toOrigin=!1,g.showTip=!0}),300)):(g.isPassing=!0,g.endTime=(new Date).getTime()),g.showTip=!0}function T(){g.showTip=!1;const t=l(r);t&&(g.isPassing=!1,t.$.resume(),w())}const S=u();return S&&(S.resume=T),()=>{const{src:e}=t,{toOrigin:s,isPassing:i,startTime:n,endTime:a}=g,d=[];s&&d.push("to-origin");const u=(a-n)/1e3;return c("div",{class:"ir-dv"},c("div",{class:"ir-dv-img__wrap",style:l(p)},c("img",{src:e,onLoad:w,width:parseInt(t.width),class:d,style:g.imgStyle,onClick:()=>{T()}}),g.showTip&&c("span",{class:["ir-dv-img__tip",g.isPassing?"success":"error"]},g.isPassing?`校验成功,耗时${u.toFixed(1)}秒！`:"验证失败！"),!g.showTip&&!g.draged&&c("span",{class:["ir-dv-img__tip","normal"]},"点击图片可刷新")),c(v,{class:"ir-dv-drag__bar",onMove:y,onEnd:x,onStart:h,ref:r,...{...o,...t},value:i,isSlot:!0}))}}});export{v as B,w as R};
